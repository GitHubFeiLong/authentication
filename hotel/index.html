<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover"
    />
    <title>维也纳</title>
    <!-- 1. 引入vue -->
    <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.13/vue.js"></script>
    <!--vue-router-->
    <script src="https://cdn.bootcdn.net/ajax/libs/vue-router/2.6.0/vue-router.min.js"></script>
    <!--vuex-->
    <script src="https://cdn.bootcdn.net/ajax/libs/vuex/3.6.2/vuex.min.js"></script>

    <link href="https://cdn.bootcdn.net/ajax/libs/vant/2.13.2/index.min.css" rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/vant/2.13.2/vant.min.js"></script>
    <!-- XLSX -->
    <!-- use xlsx.mini.min.js from version 0.20.2 -->
    <script lang="javascript" src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.mini.min.js"></script>
    <style>
        :root {
            --background-color: rgb(247, 248, 250);
            --checked-successful-color: #67C23A;
            --checked-unchecked-color: #E6A23C;
            --checked-unsuccessful-color: #F56C6C;
            --checked-successful-font-color: #fff;
            --required-color: #ee0a24;
            --van-nav-bar-height: 46px;
            --van-tabbar-height: 50px;
        }
        /* 全屏显示 */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
        }
    </style>
    <!--van-->
    <style>
        .van-nav-bar{
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }
    </style>
    <style>
        .container{
            background-color: rgb(247, 248, 250);
            -webkit-touch-callout: none !important;
            -webkit-user-select: none;
        }
        .dashboardTemplateId{

        }
        .dashboard-head{

        }
        .van-cell-group {
            background-color: #fff;
            margin: 0 16px;
            overflow: hidden;
            border-radius: 8px;
        }

        .dashboard-title-cell-group {
            height: 83px;
            padding: 5px 0;
        }
        .dashboard-statistics{
            font-size: 20px;
            text-align: center;
        }
        .dashboard-title-p{
            font-size: 18px;
            text-align: center;
            margin: 10px 0 5px 0;
            color: #3a3a3a;
        }
        .dashboard-title-span{
            margin-left: 1px;
            font-size: 20px;
        }
        .van-tabs--card>.van-tabs__wrap{
            height: 35px;
        }
        .van-tabs__nav--card {
            height: 35px;
            z-index: 100;
        }
        .van-tabs__content{
            overflow: scroll;
            max-height: 50vh;
        }
        .room_overview_content__table{
            margin: 25px 16px;
        }
        .room_overview_table{
            width: 100%;
        }
        table, th, td {
            border: 1px solid #c1c1c1;
            border-collapse: collapse; /* 移除单元格之间的间隔 */
            color:#3a3a3a;
        }
        .room_overview_table tr {
            text-align: right;
        }
        .room_overview_table tr:nth-child(1) {
            text-align: center !important;
            height: 50px;
            background-color: #b5adad5c;
        }
        .room_overview_table tr:nth-child(n + 1) {
            text-align: center;
            height: 30px;
        }

        .van-index-bar__sidebar{
            right: -10px;
            top: 60%;
            display: none;
        }
        .van-index-bar__index {
            line-height: 30px;
            font-size: 14px;
        }
        .room_overview_content__index{
            padding: 0 6px;
        }

        .room_overview_content__item > div {
            border-radius: 5px;
        }

        .overview_item_checked > div {
            background-color: var(--checked-successful-color);
            color: var(--checked-successful-font-color);
            box-shadow: -2px 5px 10px 0px rgb(103 194 58 / 50%);
        }

        .overview_item_unchecked > div {
            background-color: var(--checked-unchecked-color);
            color: var(--checked-unsuccessful-font-color);
            box-shadow: -2px 5px 10px 0px rgb(230 162 60 / 50%);
        }

        .overview_item_checked_error > div {
            background-color: var(--checked-unsuccessful-color);
            color: var(--checked-unsuccessful-font-color);
            box-shadow: -2px 5px 10px 0px rgb(245 108 108 / 50%);
        }

        /*查房*/
        .overview_item_dialog .check-room-form{
            position: relative;
            height: calc(100vh - 200px);
            overflow: scroll;
            top: unset !important;
        }

        .check-room-form{
            position: relative;
            top: 50px;
            height: calc(100vh - 150px);
            overflow: scroll;
        }
        .van-cell[required]{
            position: absolute;
            left: 8px;
            color: var(--required-color);
            font-size: 14px;
            content: '*';
        }
        .optional-cell:before{
            content: '';
        }
        .roomPrimary {
            color: #1097d0;
        }
        .roomChecked {
            color: var(--checked-successful-color);
        }

        .roomNotChecked {
            color: var(--checked-unchecked-color);
        }

        .roomIsError {
            color: var(--checked-unsuccessful-color);
        }
        .container-system-setting-form{
            position: relative;
            margin-top: 60px;
        }
        .container-system-setting-form  .van-cell-group {
            margin: unset;
        }
    </style>

</head>

<body>
    <div id="app">
        <van-nav-bar
                class="nav-bar"
                :title="this.$store.getters.title"
        ></van-nav-bar>
        <transition mode="out-in">
            <router-view></router-view>
        </transition>
        <van-tabbar v-model="active">
            <van-tabbar-item replace to="/dashboard" icon="home-o">看板</van-tabbar-item>
            <van-tabbar-item replace to="/checkRoom" icon="manager">检查</van-tabbar-item>
            <van-tabbar-item replace to="/systemSetting" icon="setting-o">设置</van-tabbar-item>
        </van-tabbar>
    </div>

    <!--仪表盘模板-->
    <template id="dashboardTemplateId">
        <div class="container container-dashboard">
            <van-sticky :offset-top="65">
                <van-cell-group class="dashboard-title-cell-group">
                    <van-row>
                        <van-col span="5" offset="1">
                            <div class="dashboard-statistics">
                                <p class="dashboard-title-p">总房数</p>
                                <van-icon name="hotel-o" class="roomPrimary" size="30"/>
                                <span class="dashboard-title-span">{{this.$store.getters.totalRoomNumber}}</span>
                            </div>
                        </van-col>
                        <van-col span="5" offset="1">
                            <div class="dashboard-statistics">
                                <p class="dashboard-title-p">未检数</p>
                                <van-icon name="warning-o" class="roomNotChecked" size="30"/>
                                <span class="dashboard-title-span">{{this.$store.getters.uncheckedRoomNumber}}</span>
                            </div>
                        </van-col>
                        <van-col span="5" offset="1">
                            <div class="dashboard-statistics">
                                <p class="dashboard-title-p">正常数</p>
                                <van-icon name="passed" class="roomChecked" size="30"/>
                                <span class="dashboard-title-span">{{this.$store.getters.unErrorRoomNumber}}</span>
                            </div>
                        </van-col>
                        <van-col span="5" offset="1">
                            <div class="dashboard-statistics">
                                <p class="dashboard-title-p">问题数</p>
                                <van-icon name="close" class="roomIsError" size="30"/>
                                <span class="dashboard-title-span">{{this.$store.getters.errorRoomNumber}}</span>
                            </div>
                        </van-col>
                    </van-row>
                </van-cell-group>
            </van-sticky>
            <van-sticky :offset-top="185">
                <van-cell-group>
                    <van-row>
                        <van-col span="24" style="font-size:18px;text-align: center; margin: 15px 0;">房间概览</van-col>
                    </van-row>
                    <van-row>
                        <van-tabs type="card" v-model="active">
                            <van-tab title="楼层速览">
                                <div class="room_overview_content__table">
                                    <table class="room_overview_table">
                                        <tr>
                                            <th>楼层</th>
                                            <th>总房数</th>
                                            <th>未检数</th>
                                            <th>正常数</th>
                                            <th>问题数</th>
                                        </tr>
                                        <tr v-for="floor in this.$store.getters.floorProgress" :key="floor.value" >
                                            <td><div @click="clickFloor(floor)">{{floor.label}}</div></td>
                                            <td><div @click="clickFloor(floor)">{{floor.totalRoomNumber}}</div></td>
                                            <td><div @click="clickFloor(floor)">{{floor.uncheckedRoomNumber}}</div></td>
                                            <td><div @click="clickFloor(floor)">{{floor.unErrorRoomNumber}}</div></td>
                                            <td><div @click="clickFloor(floor)">{{floor.errorRoomNumber}}</div></td>
                                        </tr>
                                    </table>
                                </div>
                            </van-tab>
                            <van-tab title="房间速览">
                                <div class="room_overview_content__">
                                    <van-index-bar ref="indexBar" :index-list="this.$store.getters.floorIndexList">
                                        <div class="room_overview_content__index" v-for="floor in this.$store.getters.rooms"
                                             :key="floor.value">
                                            <van-index-anchor :index="floor.label">{{floor.label}}</van-index-anchor>
                                            <van-grid square :column-num="4" :gutter="10" clickable>
                                                <van-grid-item v-for="room in floor.children" :key="room.value" class="room_overview_content__item" :class="room.checked ? (room.isError ? 'overview_item_checked_error' : 'overview_item_checked') : 'overview_item_unchecked'"
                                                @click="clickItem(room)"
                                                >
                                                    <span>{{room.label}}</span>
                                                </van-grid-item>
                                            </van-grid>
                                        </div>
                                    </van-index-bar>
                                </div>
                            </van-tab>
                        </van-tabs>
                    </van-row>
                </van-cell-group>
            </van-sticky>


            <!--弹窗-->
            <van-dialog v-model="dialog.show" :title="dialog.title" @confirm="dialogConfirm" @cancel="dialogCancel" show-cancel-button class="overview_item_dialog">
                <van-row gutter="5">
                    <van-col span="7" style="text-align: right; margin: 15px 0;">检查时间:</van-col>
                    <van-col span="17" style="text-align: left; margin: 15px 0;">{{dialog.checkedTime}}</van-col>
                </van-row>
                <check-room ref="childCheckRoom" :show-nav-bar="false" :default-room-value="dialog.roomValue" />
            </van-dialog>
        </div>
    </template>
    <!--检查房间模板-->
    <template id="checkRoomTemplateId">
        <div class="container container-check-room-form">
            <van-nav-bar
                    class="nav-bar"
                    :title="title"
                    v-show="showNavBar"
            >
                <template #left>
                    <div @click="cancel">
                        <van-icon name="cross" size="18" />
                        <span style="font-size: 16px">取消</span>
                    </div>
                </template>
                <template #right>
                    <div @click="save">
                        <van-icon name="success" size="18"/>
                        <span style="font-size: 16px">保存</span>
                    </div>
                </template>
            </van-nav-bar>
            <!--房间选择-->
            <van-popup v-model="showSelectRoomPicker" position="bottom">
                <van-picker
                        ref="roomPicker"
                        title="选择房间"
                        show-toolbar
                        :lazy-render="false"
                        :columns="this.$store.getters.rooms"
                        value-key="label"
                        @confirm="selectRoomPickerOnConfirm"
                        @cancel="showSelectRoomPicker = false"
                >
                    <template #option="item">
                        <van-row v-if="item.children">
                            <van-col :span="24">
                                <p>{{ item.label }}</p>
                            </van-col>
                        </van-row>
                        <van-row v-else>
                            <van-col :span="24" class="van-hairline--left">
                                <span :class="item.isError ? 'roomIsError' : (item.checked ? 'roomChecked' : '')">{{ item.label }}</span>
                            </van-col>
                        </van-row>
                    </template>
                </van-picker>
            </van-popup>
            <!--门牌号异常选择-->
            <van-popup v-model="showSelectHouseNumberErrorMessagePicker" position="bottom">
                <van-picker
                        title="选择门牌号问题"
                        show-toolbar
                        :columns="this.$store.getters.houseNumberErrorMessage"
                        @confirm="selectHouseNumberErrorMessagePickerOnConfirm"
                        @cancel="showSelectHouseNumberErrorMessagePicker = false"
                />
            </van-popup>
            <van-form ref="checkFormRef" class="check-room-form" @submit="onSubmitCheckForm">
                <van-cell-group inset  v-for="group in this.$store.getters.checkItems" :key="group.groupId" :title="group.groupName">
                    <van-cell v-for="item in group.items"
                              :key="item.itemId" :value="item.itemName" v-show="item.showPrecondition == null || form[item.showPrecondition] === false"
                              :required="item.required"
                    >
                        <van-row type="flex" justify="end" v-if="item.formType === 'switch' && (item.showPrecondition == null || form[item.showPrecondition] === false)">
                            <van-col span="20">{{item.itemName}}</van-col>
                            <van-col span="4">
                                <van-switch v-model="form[item.itemId]" size="20" :disabled="form.roomNumber == undefined" :active-color="successfulColor" :inactive-color="unsuccessfulColor" />
                            </van-col>
                        </van-row>
                        <van-row v-else-if="item.formType === 'picker' && item.itemId === 'roomNumber' && (item.showPrecondition == null || form[item.showPrecondition] === false)">
                            <van-col span="8">{{item.itemName}}</van-col>
                            <van-col span="16">
                                <van-field
                                        style="padding:0"
                                        readonly
                                        required
                                        clickable
                                        name="picker"
                                        class="optional-cell"
                                        :value="roomFullName"
                                        :rules="[{ required: true}]"
                                        placeholder="点击选择要检查的房间"
                                        @click="showSelectRoomPicker = true"
                                />
                            </van-col>
                        </van-row>
                        <van-row v-else-if="item.formType === 'picker' && item.itemId === 'houseNumberErrorMessage' && (item.showPrecondition == null || form[item.showPrecondition] === false)">
                            <van-col span="8">{{item.itemName}}</van-col>
                            <van-col span="16">
                                <van-field style="padding:0"
                                           readonly
                                           clickable
                                           name="picker"
                                           class="optional-cell"
                                           :value="form.houseNumberErrorMessages"
                                           placeholder="点击选择错误信息"
                                           @click="showSelectHouseNumberErrorMessagePicker = true"
                                />
                            </van-col>
                        </van-row>
                        <van-row v-else-if="item.formType === 'text' && (item.showPrecondition == null || form[item.showPrecondition] === false)">
                            <van-col span="8">{{item.itemName}}</van-col>
                            <van-col span="16">
                                <van-field style="padding: 0px" autosize  v-model="form[item.itemId]" :disabled="form.roomNumber == undefined" placeholder="请输入备注信息" />
                            </van-col>
                        </van-row>
                    </van-cell>
                </van-cell-group>
            </van-form>
        </div>
    </template>
    <!--系统设置模板-->
    <template id="systemSettingTemplateId">
        <div class="container container-system-setting-form">
            <van-cell-group inset title="数据">
                <van-cell icon="down" title="下载数据" @click="download" value="导出已检查的房间数据" ></van-cell>
                <!--<van-cell icon="share-o" title="发起分享" @click="openShare" value="将本地数据分享给其他用户" ></van-cell>
                <van-cell icon="share-o" title="发起分享" @click="openShare" :value="ipAddress.ip" ></van-cell>
                <van-cell icon="points" title="接收分享" value="接收别人分享的数据" ></van-cell>-->
                <van-cell icon="delete-o" title="重置数据" @click="reset" value="删除已操作的记录" ></van-cell>
            </van-cell-group>
        </div>
    </template>

    <!--数据相关-->
    <script type="text/javascript">
        // 楼层房间
        const RAW_FLOORS = [
            {
                value: 'secondFloor',
                label: '2楼',
                children: [
                    {value: '会议室', label: '会议室'},
                    {value: '早餐厅', label: '早餐厅'},
                    {value: '8201', label: '8201'},
                    {value: '8202', label: '8202'},
                    {value: '8203', label: '8203'},
                    {value: '8205', label: '8205'},
                    {value: '8206', label: '8206'},
                    {value: '8207', label: '8207'},
                    {value: '8208', label: '8208'},
                    {value: '8209', label: '8209'},
                    {value: '8210', label: '8210'},
                    {value: '8211', label: '8211'},
                ]
            },
            {
                value: 'fiveFloor',
                label: '5楼',
                children: [
                    {value: '8501', label: '8501'},
                    {value: '8502', label: '8502'},
                    {value: '8503', label: '8503'},
                    {value: '8505', label: '8505'},
                    {value: '8506', label: '8506'},
                    {value: '8507', label: '8507'},
                    {value: '8508', label: '8508'},
                    {value: '8510', label: '8510'},
                    {value: '8512', label: '8512'},
                    {value: '8516', label: '8516'},
                    {value: '8518', label: '8518'},
                    {value: '8519', label: '8519'},
                    {value: '8520', label: '8520'},
                    {value: '8521', label: '8521'},
                    {value: '8522', label: '8522'},
                    {value: '8523', label: '8523'},
                    {value: '8526', label: '8526'},
                    {value: '8528', label: '8528'},
                    {value: '8530', label: '8530'},
                    {value: '8555', label: '8555'},
                ]
            },
            {
                value: 'sixFloor',
                label: '6楼',
                children: [
                    {value: '8601', label: '8601'},
                    {value: '8602', label: '8602'},
                    {value: '8603', label: '8603'},
                    {value: '8605', label: '8605'},
                    {value: '8606', label: '8606'},
                    {value: '8607', label: '8607'},
                    {value: '8608', label: '8608'},
                    {value: '8610', label: '8610'},
                    {value: '8612', label: '8612'},
                    {value: '8616', label: '8616'},
                    {value: '8618', label: '8618'},
                    {value: '8619', label: '8619'},
                    {value: '8620', label: '8620'},
                    {value: '8621', label: '8621'},
                    {value: '8622', label: '8622'},
                    {value: '8623', label: '8623'},
                    {value: '8626', label: '8626'},
                    {value: '8628', label: '8628'},
                    {value: '8630', label: '8630'},
                    {value: '8666', label: '8666'},
                ]
            },
            {
                value: 'sevenFloor',
                label: '7楼',
                children: [
                    {value: '8701', label: '8701'},
                    {value: '8702', label: '8702'},
                    {value: '8703', label: '8703'},
                    {value: '8705', label: '8705'},
                    {value: '8706', label: '8706'},
                    {value: '8707', label: '8707'},
                    {value: '8708', label: '8708'},
                    {value: '8710', label: '8710'},
                    {value: '8712', label: '8712'},
                    {value: '8716', label: '8716'},
                    {value: '8718', label: '8718'},
                    {value: '8719', label: '8719'},
                    {value: '8720', label: '8720'},
                    {value: '8721', label: '8721'},
                    {value: '8722', label: '8722'},
                    {value: '8723', label: '8723'},
                    {value: '8726', label: '8726'},
                    {value: '8728', label: '8728'},
                    {value: '8730', label: '8730'},
                    {value: '7777', label: '7777'},
                ]
            },
            {
                value: 'eightFloor',
                label: '8楼',
                children: [
                    {value: '8801', label: '8801'},
                    {value: '8802', label: '8802'},
                    {value: '8803', label: '8803'},
                    {value: '8805', label: '8805'},
                    {value: '8806', label: '8806'},
                    {value: '8807', label: '8807'},
                    {value: '8808', label: '8808'},
                    {value: '8810', label: '8810'},
                    {value: '8812', label: '8812'},
                    {value: '8816', label: '8816'},
                    {value: '8818', label: '8818'},
                    {value: '8819', label: '8819'},
                    {value: '8820', label: '8820'},
                    {value: '8821', label: '8821'},
                    {value: '8822', label: '8822'},
                    {value: '8823', label: '8823'},
                    {value: '8826', label: '8826'},
                    {value: '8828', label: '8828'},
                    {value: '8830', label: '8830'},
                    {value: '8888', label: '8888'},
                ]
            },
            {
                value: 'nineFloor',
                label: '9楼',
                children: [
                    {value: '8901', label: '8901'},
                    {value: '8902', label: '8902'},
                    {value: '8903', label: '8903'},
                    {value: '8905', label: '8905'},
                    {value: '8906', label: '8906'},
                    {value: '8907', label: '8907'},
                    {value: '8908', label: '8908'},
                    {value: '8910', label: '8910'},
                    {value: '8912', label: '8912'},
                    {value: '8916', label: '8916'},
                    {value: '8918', label: '8918'},
                    {value: '8919', label: '8919'},
                    {value: '8920', label: '8920'},
                    {value: '8921', label: '8921'},
                    {value: '8922', label: '8922'},
                    {value: '8923', label: '8923'},
                    {value: '8926', label: '8926'},
                    {value: '8928', label: '8928'},
                    {value: '8930', label: '8930'},
                    {value: '8999', label: '8999'},
                ]
            },
            {
                value: 'tenFloor',
                label: '10楼',
                children: [
                    {value: '董办', label: '董办'},
                    {value: '1001', label: '1001'},
                    {value: '1002', label: '1002'},
                    {value: '1003', label: '1003'},
                    {value: '1005', label: '1005'},
                    {value: '1006', label: '1006'},
                    {value: '1008', label: '1008'},
                    {value: '1010', label: '1010'},
                    {value: '1012', label: '1012'},
                    {value: '1016', label: '1016'},
                    {value: '1017', label: '1017'},
                    {value: '1018', label: '1018'},
                    {value: '1019', label: '1019'},
                    {value: '1020', label: '1020'},
                    {value: '1021', label: '1021'},
                    {value: '1022', label: '1022'},
                    {value: '1023', label: '1023'},
                    {value: '1026', label: '1026'},
                    {value: '1028', label: '1028'},
                    {value: '1030', label: '1030'},
                ]
            },
        ]
        // 房间缓存
        const ROOM_INFO_KEY = "roomInfoKey:${roomNumber}";
        const SUCCESSFUL_COLOR = '#67C23A'
        const UNSUCCESSFUL_COLOR = '#F56C6C'
        const UNCHECKED_COLOR = '#E6A23C'

        // 检查的选项
        const RAW_CHECK_ITEMS = [
            {
                groupId:'选择房间', groupName:'选择房间', items:[
                    {itemId:'roomNumber', itemName: '选择房间', formType: 'picker', defaultValue: undefined, required: true, excelCol: true, order: 0},
                ]
            },
            {
                groupId:'门牌号', groupName:'门牌号', items:[
                    {itemId:'houseNumber', itemName: '门牌号', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'houseNumberErrorMessage', itemName: '门牌号异常信息', formType: 'picker', defaultValue: true, showPrecondition:'houseNumber'},
                    {itemId:'airSwitch', itemName: '空开', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'peculiarSmell', itemName: '异味', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                ]
            },
            {
                groupId:'卫生间', groupName:'卫生间', items:[
                    {itemId:'toiletDoor', itemName: '厕所门', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'washbasinGlue', itemName: '洗手台胶', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'toiletGlue', itemName: '马桶胶', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'ceiling', itemName: '天花板', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'washbasin', itemName: '脸盆', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'bathroomExhaustFan', itemName: '卫生间排风扇', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'faucet', itemName: '水龙头', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                ]
            },
            {
                groupId:'橱柜', groupName:'橱柜', items:[
                    {itemId:'wardrobe', itemName: '衣柜', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'kettle', itemName: '烧水壶', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                ]
            },
            {
                groupId:'睡觉', groupName:'睡觉', items:[
                    {itemId:'airConditioner', itemName: '空调', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'TV', itemName: '电视', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'TVRemoteControl', itemName: '电视遥控器', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'carpet', itemName: '地毯', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'wallCloth', itemName: '墙布', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                ]
            },
            {
                groupId:'休息区', groupName:'休息区', items:[
                    {itemId:'window', itemName: '窗户', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'sofa', itemName: '沙发', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                    {itemId:'swivelChair', itemName: '转椅', formType: 'switch', defaultValue: true, excelCol: true, order: 0},
                ]
            },
            {
                groupId:'其他', groupName:'其他', items:[
                    {itemId:'remark', itemName: '备注', formType: 'text', defaultValue: '', excelCol: true, order: 0},
                ]
            },
        ];

        const RAW_ITEMS = []
        RAW_CHECK_ITEMS.forEach(group => group.items.forEach(item => RAW_ITEMS.push(item)))
        RAW_CHECK_ITEMS.sort((o1, o2) => o1.order - o2.order)
    </script>
    <!--缓存相关-->
    <script type="text/javascript">
        const localStorage = window.localStorage;
        function getItem(key) {
            return localStorage.getItem(key);
        }

        function setItem(key, value) {
            return localStorage.setItem(key, value);
        }

        function removeItem(key) {
            return localStorage.removeItem(key);
        }

        function clear() {
            return localStorage.clear();
        }
    </script>
    <!--工具相关-->
    <script type="text/javascript">
        /**
         * 获取key
         */
        function getKey(template, ...values) {
            let result;
            for (const value of values) {
                result = template = template.replace(/\$\{[a-zA-Z0-9]+\}/, value)
            }
            return result
        }

        /**
         * 格式话日期 yyyy-MM-dd HH:mm:ss
         * @param date
         * @returns {string}
         */
        function formatDateTime(date) {
            date = new Date();
            let fullYear = date.getFullYear();
            let month = date.getMonth() + 1;
            let day = date.getDate();
            let hours = date.getHours();
            let minutes = date.getMinutes();
            let seconds = date.getSeconds();

            month = month < 10 ? '0' + month : month;
            day = day < 10 ? '0' + day : day;
            hours = hours < 10 ? '0' + hours : hours;
            minutes = minutes < 10 ? '0' + minutes : minutes;
            seconds = seconds < 10 ? '0' + seconds : seconds;

            return `${fullYear}-${month}-${day} ${hours}:${minutes}:${seconds}`
        }
    </script>
    <!--VUE-->
    <script type="text/javascript">

        Vue.use(Vuex)

        const store = new Vuex.Store({
            // 状态
            state: {
                title: '看板', // 顶部导航栏title
                // 所有楼层房间信息
                rooms: [],
                floorIndexList: [], // 房间索引
                // 检查的选项
                checkItems: RAW_CHECK_ITEMS,
                // 检查项
                items: RAW_ITEMS,
                // 异常下拉
                roomError:{
                    houseNumberErrorMessage: [
                        { text: '门铃不响'},
                        { text: '灯不亮'},
                        { text: '门铃不响且灯不亮'},
                    ],
                },
                // 总房间数
                totalRoomNumber: 0,
                // 已检查房间数
                checkedRoomNumber: 0,
                // 未检查房间数
                uncheckedRoomNumber: 0,
                // 没有问题房间数
                unErrorRoomNumber: 0,
                // 有问题房间数
                errorRoomNumber: 0,
                successfulColor: SUCCESSFUL_COLOR,
                unsuccessfulColor: UNSUCCESSFUL_COLOR,
                uncheckedColor: UNCHECKED_COLOR,
            },
            // 包含多个更新state函数的对象
            mutations: {
                /**
                 * 设置title
                 * @param state
                 * @param value
                 */
                setTitle(state, value) {
                  state.title = value
                },
                /**
                 * 实时计算房间数，已检，未检，问题
                 * @param state
                 */
                calculateRoomNumber(state) {
                    let totalRoomNumber = 0;
                    let checkedRoomNumber = 0;
                    let uncheckedRoomNumber = 0;
                    let errorRoomNumber = 0;
                    let unErrorRoomNumber = 0;
                    // 楼层
                    for (const floor of state.rooms) {
                        // 楼层房间
                        for(const room of floor.children) {
                            totalRoomNumber++
                            if(room.checked){
                                checkedRoomNumber++
                                if(room.isError) {
                                    errorRoomNumber++
                                } else {
                                    unErrorRoomNumber++
                                }
                            } else {
                                uncheckedRoomNumber++
                            }
                        }
                    }
                    state.totalRoomNumber = totalRoomNumber
                    state.checkedRoomNumber = checkedRoomNumber
                    state.uncheckedRoomNumber = uncheckedRoomNumber
                    state.errorRoomNumber = errorRoomNumber
                    state.unErrorRoomNumber = unErrorRoomNumber

                    console.log("totalRoomNumber:" +  totalRoomNumber + ", checkedRoomNumber" + checkedRoomNumber + ", uncheckedRoomNumber:" + uncheckedRoomNumber + ", unErrorRoomNumber:" + unErrorRoomNumber + ", errorRoomNumber" + errorRoomNumber)
                },
                /**
                 * 初始化房间
                 * @param state
                 */
                initRooms(state) {
                    state.rooms = []
                    let totalRoomNumber = 0;
                    let checkedRoomNumber = 0;
                    let uncheckedRoomNumber = 0;
                    let unErrorRoomNumber = 0;
                    let errorRoomNumber = 0;
                    // 楼层
                    for (const rawFloor of RAW_FLOORS) {
                        // 添加楼层
                        let floorRooms = []
                        // 楼层房间
                        for(const rawFloorRoom of rawFloor.children) {
                            totalRoomNumber++
                            let rawFloorRoomValue = rawFloorRoom.value
                            // 从缓存取
                            let cacheKey = getKey(ROOM_INFO_KEY, rawFloorRoomValue)
                            let cacheValue = getItem(cacheKey);
                            if (cacheValue !== undefined && cacheValue !== null) {
                                let room = JSON.parse(cacheValue)
                                let isError = room.isError
                                if (isError) {
                                    errorRoomNumber++
                                } else {
                                    unErrorRoomNumber++
                                }
                                floorRooms.push({
                                    value: rawFloorRoom.value,
                                    label: rawFloorRoom.label,
                                    checked: true,
                                    isError: isError,
                                    checkedTime: undefined
                                })
                                checkedRoomNumber++;
                            } else {
                                floorRooms.push({
                                    value: rawFloorRoom.value,
                                    label: rawFloorRoom.label,
                                    checked: false,
                                    isError: false,
                                    checkedTime: undefined
                                })
                                uncheckedRoomNumber++
                            }
                        }
                        let floorItem = {value: rawFloor.value, label: rawFloor.label, children: floorRooms}
                        state.rooms.push(floorItem)

                        //
                        state.floorIndexList.push(rawFloor.label)

                    }

                    // 设置房间个状态数量
                    state.totalRoomNumber = totalRoomNumber
                    state.checkedRoomNumber = checkedRoomNumber
                    state.uncheckedRoomNumber = uncheckedRoomNumber
                    state.unErrorRoomNumber = unErrorRoomNumber
                    state.errorRoomNumber = errorRoomNumber
                    console.log("totalRoomNumber:" +  totalRoomNumber + ", checkedRoomNumber" + checkedRoomNumber + ", uncheckedRoomNumber:" + uncheckedRoomNumber + ", unErrorRoomNumber:" + unErrorRoomNumber + ", errorRoomNumber" + errorRoomNumber)


                    console.log("state.rooms", state.rooms)
                },
                /**
                 * 修改房间状态
                 * @param state
                 * @param {object} data
                 * @param {object} data.newRoom 房间新状态
                 * @param {string} data.newRoom.value 房间唯一标识
                 * @param {boolean} data.newRoom.checked true 已检查；false 未检查
                 * @param {boolean} data.newRoom.isError true 问题；false 正常
                 * @param {string} data.newRoom.checkedTime 检查时间
                 * @param {object} data.form 保存的数据
                 */
                changeRoomStatus(state, data) {
                    console.log("修改房间状态，并修改状态数量，参数：", data)
                    state.rooms.forEach(floor => {
                        floor.children.forEach(room => {
                            if (room.value === data.newRoom.value) {
                                room.checked = data.newRoom.checked;
                                room.isError = data.newRoom.isError;
                                room.checkedTime = data.newRoom.checked ? data.newRoom.checkedTime : null;
                                let key = getKey(ROOM_INFO_KEY, data.newRoom.value)
                                if (data.newRoom.checked) {
                                    data.form.checkedTime = room.checkedTime
                                    // 保存
                                    let roomInfo = JSON.stringify(data.form);
                                    setItem(key, roomInfo)
                                } else {
                                    // 设置未检查状态删除缓存
                                    removeItem(key);
                                }
                                return;
                            }
                        })
                    })
                    console.log("重新计算房间各个状态的数量")
                    this.commit('calculateRoomNumber')
                },

                /**
                 * 重置
                 * @param state
                 */
                rest(state) {
                    localStorage.clear()
                    this.commit('initRooms');
                },
            },
            // 包含多个对应事件回调函数,有返回值是一个promise
            actions:{
                /**
                 * 根据房间号获取楼层
                 * @param state
                 * @param roomValue
                 */
                getRoomFloor({state}, roomValue) {
                    let floorLabel;
                    state.rooms.forEach(floor => {
                        floor.children.forEach(room => {
                            if (room.value === roomValue) {
                                floorLabel = floor.label
                                console.log("floorLabel = " + floorLabel)
                                return floorLabel;
                            }
                        })
                    })
                    return floorLabel;
                },
            },
            getters:{
                title: () => store.state.title,
                rooms:() => store.state.rooms,
                floorIndexList: () => store.state.floorIndexList,
                floorProgress:() => {
                    let floors = [];
                    for (const floor of store.state.rooms) {
                        // 总房间数
                        let totalRoomNumber = floor.children.length
                        // 已检查房间数
                        let checkedRoomNumber = 0
                        // 未检查房间数
                        let uncheckedRoomNumber = 0
                        // 有问题房间数
                        let errorRoomNumber = 0
                        // 没有问题房间数
                        let unErrorRoomNumber = 0
                        for (const room of floor.children) {
                            if (room.checked) {
                                checkedRoomNumber++
                                if (room.isError) {
                                    errorRoomNumber++
                                } else {
                                    unErrorRoomNumber++
                                }
                            } else {
                                uncheckedRoomNumber++
                            }
                        }
                        let floorInfo = {
                            value: floor.value,
                            label: floor.label,
                            totalRoomNumber,
                            checkedRoomNumber,
                            uncheckedRoomNumber,
                            errorRoomNumber,
                            unErrorRoomNumber,
                            children: floor.children
                        }
                        floors.push(floorInfo)
                    }
                    console.log("floors", floors)
                    return floors
                },
                checkItems: () => store.state.checkItems,
                items: () => store.state.items,
                //===
                houseNumberErrorMessage:() => store.state.roomError.houseNumberErrorMessage,
                //==
                totalRoomNumber:() => store.state.totalRoomNumber,
                checkedRoomNumber:() => store.state.checkedRoomNumber,
                uncheckedRoomNumber:() => store.state.uncheckedRoomNumber,
                unErrorRoomNumber:() => store.state.unErrorRoomNumber,
                errorRoomNumber:() => store.state.errorRoomNumber,
                successfulColor:() => store.state.successfulColor,
                unsuccessfulColor:() => store.state.unsuccessfulColor,
                uncheckedColor:() => store.state.uncheckedColor,
            }
        })

        /**
         * 仪表盘组件
         */
        const dashboardComponent = Vue.component('dashboard', Vue.extend({
            name: 'dashboard',
            template: '#dashboardTemplateId',
            data(){
                return {
                    timeOutEvent: null,
                    active: 0,
                    dialog: {
                        show: false,
                        title: null,
                        roomValue: null,
                        checkedTime: null,
                    },

                }
            },
            methods:{
                /**
                 * 点击某个房间
                 * @param {object} room
                 * @param {object} room.value 房间名
                 * @param {object} room.checked 是否已检
                 * @param {object} room.isError 是否错误
                 */
                clickItem(room) {
                    console.log("room", room)
                    if (this.timeOutEvent !== null) {
                        clearTimeout(this.timeOutEvent)
                        console.log("双击")
                        this.timeOutEvent = null;
                        if (room.checked) {
                            vant.Dialog.confirm({
                                title: "修改房间状态",
                                message: '是否修改房间 ' + room.value + ' 为未检查？',
                            }).then(() => {
                                console.log("确认")
                                // on confirm
                                let newRoom = {newRoom:{value: room.value, checked: false, isError: false, checkedTime: null}}
                                this.$store.commit('changeRoomStatus', newRoom)
                            }).catch(() => {
                                console.log("取消")
                                // on cancel
                            });
                        } else {

                        }

                    } else {
                        this.timeOutEvent = setTimeout(() => {
                            this.timeOutEvent = null;
                            console.log("单击")
                            this.dialog.show = true
                            this.dialog.title = room.value
                            this.dialog.roomValue = room.value
                            if (room.checkedTime) {
                                this.dialog.checkedTime = room.checkedTime
                            } else {
                                this.dialog.checkedTime = '-'
                            }

                        }, 250);
                    }
                },

                /**
                 * 弹窗点击确定
                 */
                dialogConfirm(){
                    // 调用子组件的方法
                    this.$refs.childCheckRoom.save();
                },
                /**
                 * 弹窗点击取消
                 */
                dialogCancel() {


                },

                /**
                 * 点击楼层
                 */
                clickFloor(floor) {
                    console.log(floor)
                    this.active = 1
                    // 确保dom加载成功再执行
                    this.$nextTick(() => {
                        this.$refs.indexBar.scrollTo(floor.label)
                    });
                },


            },
            watch: {

            },
            beforeCreate(){
            },
            created() {
                this.$store.commit('setTitle', "看板");
            }
        }))

        /**
         * 查房组件
         */
        const checkRoomComponent = Vue.component('checkRoom', Vue.extend({
            name: 'checkRoom',
            template: '#checkRoomTemplateId',
            props:{
                showNavBar: {
                    type: Boolean,
                    required: false,
                    default: true,
                },
                defaultRoomValue: {
                    type: String,
                    required: false,
                    default: null
                }
            },
            data(){
                return {
                    successfulColor: SUCCESSFUL_COLOR,
                    unsuccessfulColor: UNSUCCESSFUL_COLOR,
                    uncheckedColor: UNCHECKED_COLOR,
                    // showNavBar: true, // 是否显示导航栏
                    // 显示下拉
                    showSelectRoomPicker: false,
                    showSelectHouseNumberErrorMessagePicker: false,
                    roomFullName: undefined,
                    title: '查房',
                    form: {
                        roomNumber: undefined,      // 房号
                        peculiarSmell: true,   // 异味
                        houseNumber: true,     // 门牌号
                        wardrobe: true,        // 衣柜
                        window: true,          // 窗户
                        wallCloth: true,       // 墙布
                        sofa: true,            // 沙发
                        TVRemoteControl: true, // 电视遥控器
                        TV: true,              // 电视
                        toiletDoor: true,      // 厕所门
                        washbasinGlue: true,  // 洗手台胶
                        toiletGlue: true,      // 马桶胶
                        ceiling: true,         // 天花板
                        washbasin: true,       // 脸盆
                        kettle: true,          // 烧水壶
                        airConditioner: true,  // 空调
                        bathroomExhaustFan: true,    // 卫生间排风扇
                        carpet: true,          // 地毯
                        airSwitch: true,       // 空开
                        swivelChair: true,     // 转椅
                        faucet: true,          // 水龙头

                        remark: undefined,          // 备注
                        isError: undefined,         /// 是否有问题
                        checkedTime: undefined,     /// 检查时间

                        // 需要存储到缓存的额外字段
                        houseNumberErrorMessages: undefined,     /// 门牌号异常信息
                    },
                }
            },
            methods:{
                /**
                 * 选房间
                 * @param value
                 */
                selectRoomPickerOnConfirm(value) {
                    this.roomFullName = value[0] + ' ' + value[1]
                    this.form.roomNumber = value[1]
                    this.showSelectRoomPicker = false;
                },
                /**
                 * 选房牌号错误
                 * @param value
                 */
                selectHouseNumberErrorMessagePickerOnConfirm(value) {
                    console.log(value.text)
                    this.form.houseNumberErrorMessages = value.text
                    this.showSelectHouseNumberErrorMessagePicker = false;
                },
                /**
                 * 检查房间，切换房间
                 * @param selectData    选中的value
                 */
                checkRoomChangeRoom(selectData) {
                    this.checkRoom.form.roomNumber = selectData[1]
                    console.log(selectData)
                },
                /**
                 * 是否显示item
                 */
                showFormItem() {
                    return this.form.roomNumber !== null && this.form.roomNumber !== undefined
                },
                /**
                 * 获取房间的缓存信息，如果缓存不存在就用默认值
                 * @param
                 */
                getRoomInfo(roomNumber) {
                    let key = getKey(ROOM_INFO_KEY, roomNumber)
                    let roomInfo = JSON.parse(getItem(key))
                    console.log(roomNumber + "房间的信息：" + roomInfo);
                    if (roomInfo === null || roomInfo === undefined) {
                        this.initCheckRoomForm(roomNumber);
                        return this.form
                    } else {
                        this.form = { ...roomInfo }
                    }

                    return roomInfo;
                },
                /**
                 * 初始化房间
                 */
                initCheckRoomForm(roomNumber) {
                    console.log("initCheckRoomForm")
                    // 传的null
                    if (!roomNumber) {
                        this.roomFullName = null;
                    }
                    let items = this.$store.getters.items
                    for (const formKey in this.form) {
                        if (roomNumber == null) {
                            this.form[formKey] = undefined
                        } else {
                            // 除了房间号，其他需要设置
                            if (formKey !== 'roomNumber') {
                                for(item of items) {
                                    if (formKey === item.itemId) {
                                        this.form[formKey] = item.defaultValue;
                                    }
                                }
                            }
                        }
                    }
                },
                /**
                 * 选择房牌号的错误信息
                 */
                changeHouseNumberErrorMessage(e) {
                    console.log(e)
                    this.dialog.checkRoom.form.houseNumberErrorMessages = e.join(',')
                    console.log(this.dialog.checkRoom.form.houseNumberErrorMessages);
                },
                /**
                 * 关闭/取消检查房间弹窗
                 */
                cancel() {
                    this.initCheckRoomForm(null)
                    this.roomFullName = undefined
                    this.title = '查房'
                    // this.$router.push('/')
                },

                /**
                 * 保存
                 * @param {Number} model 模式，0保存并关闭；1：保存并继续
                 */
                save() {
                    this.$refs.checkFormRef.submit()
                },
                /**
                 * 表单提交
                 */
                onSubmitCheckForm(){
                    // 当前操作的房间号
                    let roomNumber = this.form.roomNumber

                    let now = formatDateTime(new Date())
                    let data = {
                        newRoom: {value: roomNumber, checked: true, isError: this.isErrorRoom(), checkedTime: now},
                        form: this.form,
                    }
                    console.log("roomNumber", data);
                    this.$store.commit('changeRoomStatus', data)
                    console.log(this.$refs)
                    if (this.$refs.roomPicker != null) {
                        this.$refs.roomPicker.setValues(this.$store.getters.rooms)
                    }
                    vant.Toast.success('保存成功');
                },

                /**
                 * 判断房间是不是有问题
                 * @param room
                 * @returns {boolean}
                 */
                isErrorRoom() {
                    let room = this.form
                    console.log("room", room)
                    if (room) {
                        let isError = !room.peculiarSmell ||
                            !room.houseNumber ||
                            !room.wardrobe ||
                            !room.window ||
                            !room.wallCloth ||
                            !room.sofa ||
                            !room.TVRemoteControl ||
                            !room.TV ||
                            !room.toiletDoor ||
                            !room.washbasinGlue ||
                            !room.toiletGlue ||
                            !room.ceiling ||
                            !room.washbasin ||
                            !room.kettle ||
                            !room.airConditioner ||
                            !room.bathroomExhaustFan ||
                            !room.carpet ||
                            // !room.airSwitch ||
                            !room.swivelChair ||
                            !room.faucet

                        this.form.isError = isError

                        return isError
                    }
                },
            },
            watch: {
                /**
                 * 房间号下拉
                 */
                'form.roomNumber': function (n, o) {
                    console.log("checkRoom.form.roomNumber");
                    if (n !== null && n !== undefined) {
                        console.log(n);
                        this.getRoomInfo(n)
                    } else {
                        this.title = '查房'
                    }
                },
                /**
                 * 门牌号
                 */
                'form.houseNumber': {
                    handler(n, o) {
                        if (n) {
                            this.form.houseNumberErrorMessages = null;
                        }
                    }
                },
                defaultRoomValue: {
                    handler(n, o) {
                        if (n) {
                            if (this.defaultRoomValue) {
                                this.$store.dispatch("getRoomFloor", this.defaultRoomValue).then((floor) => {
                                    this.roomFullName = floor + ' ' + this.defaultRoomValue
                                });
                                this.form.roomNumber = this.defaultRoomValue
                            }
                        }
                    }
                }
            },
            created() {
                this.initCheckRoomForm(null)
                if (this.defaultRoomValue) {
                    this.$store.dispatch("getRoomFloor", this.defaultRoomValue).then((floor) => {
                        this.roomFullName = floor + ' ' + this.defaultRoomValue
                    });
                    this.form.roomNumber = this.defaultRoomValue
                }
                this.$store.commit('setTitle', "检查");
            }
        }))

        /**
         * 系统设置组件
         */
        const systemSettingComponent = Vue.component('systemSetting', Vue.extend({
            name: 'systemSetting',
            template: '#systemSettingTemplateId',
            data(){
                return {
                    ipAddress: {
                        ip: null,
                        location: null,
                        type: null,
                    }
                }
            },
            methods:{
                /**
                 * 转换
                 */
                convert(value) {
                    if (value !== undefined && value !== null) {
                        if (value === false) {
                            return '×'
                        }

                        if (value === true) {
                            return '√'
                        }
                        return value;
                    }

                    return ''
                },
                download() {
                    let exportData = [];
                    let serialNumber = 1;
                    for (const floor of this.$store.getters.rooms) {
                        for (const room of floor.children) {
                            if (room.checked) {
                                // 获取缓存
                                let key = getKey(ROOM_INFO_KEY, room.label)
                                let roomInfo = JSON.parse(getItem(key));
                                if (roomInfo != null) {
                                    // 使用中文key
                                    exportData.push({
                                        '序号': serialNumber++,
                                        '房号': this.convert(roomInfo.roomNumber),
                                        '异味': this.convert(roomInfo.peculiarSmell),   // 异味
                                        '门牌号': this.convert(roomInfo.houseNumber) + ' ' + this.convert(roomInfo.houseNumberErrorMessages),     // 门牌号
                                        '衣柜': this.convert(roomInfo.wardrobe),        // 衣柜
                                        '窗户': this.convert(roomInfo.window),          // 窗户
                                        '墙布': this.convert(roomInfo.wallCloth),       // 墙布
                                        '沙发': this.convert(roomInfo.sofa),            // 沙发
                                        '电视遥控器': this.convert(roomInfo.TVRemoteControl), // 电视遥控器
                                        '电视': this.convert(roomInfo.TV),              // 电视
                                        '厕所门': this.convert(roomInfo.toiletDoor),      // 厕所门
                                        '洗手台胶': this.convert(roomInfo.washbasinGlue),  // 洗手台胶
                                        '马桶胶': this.convert(roomInfo.toiletGlue),      // 马桶胶
                                        '天花板': this.convert(roomInfo.ceiling),         // 天花板
                                        '脸盆': this.convert(roomInfo.washbasin),       // 脸盆
                                        '烧水壶': this.convert(roomInfo.kettle),          // 烧水壶
                                        '空调': this.convert(roomInfo.airConditioner),  // 空调
                                        '卫生间排风扇': this.convert(roomInfo.bathroomExhaustFan),    // 卫生间排风扇
                                        '地毯': this.convert(roomInfo.carpet),          // 地毯
                                        '空开': this.convert(roomInfo.airSwitch),       // 空开
                                        '转椅': this.convert(roomInfo.swivelChair),     // 转椅
                                        '水龙头': this.convert(roomInfo.faucet),          // 水龙头
                                        '备注': this.convert(roomInfo.remark),          // 备注
                                    })
                                }
                            }
                        }
                    }

                    // 将数据转换为 worksheet 对象
                    console.log(exportData);
                    const worksheet = XLSX.utils.json_to_sheet(exportData);

                    // 将 worksheet 对象添加到 workbook 中
                    const workbook = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet1');

                    // 导出 Excel 文件
                    XLSX.writeFile(workbook, formatDateTime(new Date()) + ".xlsx");
                },
                /**
                 *
                 */
                openShare() {
                    this.getIpAddress();
                    // this.test();

                },
                test() {

                },
                getIpAddress() { //获取ip, 位置
                    let year = new Date().getFullYear();
                    fetch(`https://${year}.ip138.com/`)
                        .then(x => {
                            console.log(x)
                            return x.text()
                        })
                        .then(h => {
                        let domParser = new DOMParser();
                        let doc = domParser.parseFromString(h, "text/html");
                        let text = doc?.querySelector('p')?.innerText?.trim();
                        console.log(text)//您的iP地址是：[xxx.xx.xxx.xxx ] 来自：中国上海xx xx
                        try {
                            let ip = text.substring(text.indexOf("[") + 1, text.indexOf("]")).trim();
                            this.ipAddress.ip = ip;
                            let other = text.substring(text.indexOf("来自：") + 3).trim();
                            let arr = other.split(" ");
                            this.ipAddress.location = arr[0];
                            this.ipAddress.type = arr[1];
                        } catch (e) {
                            console.error(e)
                        }
                    })
                },

                /**
                 * 重置
                 */
                reset() {
                    vant.Dialog.confirm({
                        message: '确认重置数据吗？',
                    }).then(() => {
                        this.$store.commit('rest');
                        vant.Toast.success("重置成功");
                    }).catch(() => {
                        console.log("已取消重置数据请求")
                    });
                }
            },
            created() {
                this.$store.commit('setTitle', "设置");
            }
        }))

        /*组件*/
        var routerObj = new VueRouter({
            //  route // 这个配置对象中的 route 表示 【路由匹配规则】 的意思
            routes:[ // 路由匹配规则
                // 每个路由规则，都是一个对象，这个规则对象身上，有两个必须的属性：
                // 属性1：是path，表示监听哪个路由链接地址
                // 属性2：是 component， 表示，如果 路由是前面匹配到的 path，则展示 component 属性对应的那个组件
                //  注意：component 的属性值，必须是一个 组件模板对象，不能是模板名称
                {path:'/', redirect: '/dashboard', meta: {active: 0}}, // 这里的 redirect 和 Node 中的 redirect 完全是两码事
                {path:'/dashboard', component: dashboardComponent, meta: {active: 0}},
                {path:'/checkRoom', component: checkRoomComponent, meta: {active: 1}},
                {path:'/systemSetting', component: systemSettingComponent, meta: {active: 2}},

            ]
            ,linkActiveClass:'myactive'
        });

        const vm = new Vue({
            el: '#app',
            data: {
                active: 0,
                // 单选框
                successfulColor: '#67C23A',
                unsuccessfulColor: '#F56C6C',
            },
            methods: {

            },
            created(){
                let meta = this.$router.currentRoute.meta;
                if (meta && meta.active >= 0) {
                    this.active = meta.active
                }
                console.log(this.$router.currentRoute)
            },
            mounted() {
                this.$store.commit('initRooms')
            },
            watch: {

            },
            router:routerObj,
            store
        })

        Vue.use(vant.Lazyload);
        Vue.use(vant.Picker);
        Vue.use(vant.Tabbar);
        Vue.use(vant.TabbarItem);
    </script>

    <script type="text/javascript">

    </script>

</body>

</html>
