<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover"
    />
    <title>维也纳</title>
    <!-- 1. 引入vue -->
    <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.13/vue.js"></script>
    <!--vue-router-->
    <script src="https://cdn.bootcdn.net/ajax/libs/vue-router/2.6.0/vue-router.min.js"></script>
    <!--vuex-->
    <script src="https://cdn.bootcdn.net/ajax/libs/vuex/3.6.2/vuex.min.js"></script>

    <link href="https://cdn.bootcdn.net/ajax/libs/vant/2.13.2/index.min.css" rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/vant/2.13.2/vant.min.js"></script>
    <!-- XLSX -->
    <!-- use xlsx.mini.min.js from version 0.20.2 -->
    <script lang="javascript" src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.mini.min.js"></script>
    <style>
        /* 全屏显示 */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        :root {
            --checked-successful-color: #67C23A;
            --checked-unchecked-color: #E6A23C;
            --checked-unsuccessful-color: #F56C6C;
            --checked-successful-font-color: #fff;
        }
    </style>
    <!--van-->
    <style>
        .van-nav-bar{
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }
    </style>
    <style>
        .container-check-room-form{
            background-color: rgb(247, 248, 250);
            margin-top: 80px;
        }
        .check-room-form{

        }
    </style>

</head>

<body>
    <div id="app">
        <transition mode="out-in">
            <router-view></router-view>
        </transition>
        <van-tabbar v-model="active" v-show="this.$store.getters.showFootMenu">
            <van-tabbar-item replace to="/login" icon="home-o">看板</van-tabbar-item>
            <van-tabbar-item replace to="/checkRoom" icon="manager">检查</van-tabbar-item>
            <van-tabbar-item replace to="/login" icon="eye-o">预览</van-tabbar-item>
            <van-tabbar-item replace to="/login" icon="setting-o">设置</van-tabbar-item>
        </van-tabbar>
    </div>

    <!--检查房间模板-->
    <template id="checkRoomTemplateId">
        <div class="container container-check-room-form">
            <van-nav-bar
                    class="nav-bar"
                    :title="title"
                    left-text="返回"
                    left-arrow
                    @click-left="exitCheckRoom"
            >

            </van-nav-bar>
            <!--房间选择-->
            <van-popup v-model="showSelectRoomPicker" position="bottom">
                <van-picker
                        show-toolbar
                        :columns="this.$store.getters.rooms"
                        value-key="label"
                        @confirm="selectRoomPickerOnConfirm"
                        @cancel="showSelectRoomPicker = false"
                />
            </van-popup>
            <!--门牌号异常选择-->
            <van-popup v-model="showSelectHouseNumberErrorMessagePicker" position="bottom">
                <van-picker
                        show-toolbar
                        :columns="this.$store.getters.houseNumberErrorMessage"
                        @confirm="selectHouseNumberErrorMessagePickerOnConfirm"
                        @cancel="showSelectHouseNumberErrorMessagePicker = false"
                />
            </van-popup>

            <van-form class="check-room-form" @submit="saveDialogCheckRoom(1)" style="z-index: 20">
                <van-cell-group inset>
                    <van-field
                            readonly
                            clickable
                            name="picker"
                            :value="roomFullName"
                            label="选择房间"
                            placeholder="点击选择要检查的房间"
                            @click="showSelectRoomPicker = true"
                    />
                </van-cell-group>
                <van-cell-group inset v-for="group in this.$store.getters.checkItems" :title="group.groupName">
                    <van-cell v-for="item in group.items" :title="item.itemName" :value="item.name">
                        <van-field v-if="item.formType === 'switch' && (item.showPrecondition == null || form[item.showPrecondition] === false)"
                                   :label="item.itemName"
                                   :value="form[item.id]"
                                   @click="showSelectHouseNumberErrorMessagePicker = true"
                        >
                            <template #input>
                                <van-switch v-model="switchChecked" size="20" />
                            </template>
                        </van-field>
                        <van-field v-else-if="item.formType === 'picker' && (item.showPrecondition == null || form[item.showPrecondition] === false)"
                                   :label="item.itemName"
                                   :value="form[item.id]"
                                   @click="showSelectHouseNumberErrorMessagePicker = true"
                        />
                        <van-field v-else-if="item.formType === 'text' && (item.showPrecondition == null || form[item.showPrecondition] === false)"
                                   :label="item.itemName"
                                   :value="form[item.id]"
                                   placeholder="请输入备注"
                        />
                    </van-cell>
                </van-cell-group>
                <van-cell-group >
                    <div style="margin: 20px 15px; position: relative">
                        <van-button round block type="info" native-type="submit">提交</van-button>
                    </div>
                </van-cell-group>
            </van-form>
        </div>
    </template>

    <!--数据相关-->
    <script type="text/javascript">
        // 楼层房间
        const RAW_FLOORS = [
            {
                value: 'secondFloor',
                label: '2楼',
                children: [
                    {value: '会议室', label: '会议室'},
                    {value: '早餐厅', label: '早餐厅'},
                    {value: '8201', label: '8201'},
                    {value: '8202', label: '8202'},
                    {value: '8203', label: '8203'},
                    {value: '8205', label: '8205'},
                    {value: '8206', label: '8206'},
                    {value: '8207', label: '8207'},
                    {value: '8208', label: '8208'},
                    {value: '8209', label: '8209'},
                    {value: '8210', label: '8210'},
                    {value: '8211', label: '8211'},
                ]
            },
            {
                value: 'fiveFloor',
                label: '5楼',
                children: [
                    {value: '8501', label: '8501'},
                    {value: '8502', label: '8502'},
                    {value: '8503', label: '8503'},
                    {value: '8505', label: '8505'},
                    {value: '8506', label: '8506'},
                    {value: '8507', label: '8507'},
                    {value: '8508', label: '8508'},
                    {value: '8510', label: '8510'},
                    {value: '8512', label: '8512'},
                    {value: '8516', label: '8516'},
                    {value: '8518', label: '8518'},
                    {value: '8519', label: '8519'},
                    {value: '8520', label: '8520'},
                    {value: '8521', label: '8521'},
                    {value: '8522', label: '8522'},
                    {value: '8523', label: '8523'},
                    {value: '8526', label: '8526'},
                    {value: '8528', label: '8528'},
                    {value: '8530', label: '8530'},
                    {value: '8555', label: '8555'},
                ]
            },
            {
                value: 'sixFloor',
                label: '6楼',
                children: [
                    {value: '8601', label: '8601'},
                    {value: '8602', label: '8602'},
                    {value: '8603', label: '8603'},
                    {value: '8605', label: '8605'},
                    {value: '8606', label: '8606'},
                    {value: '8607', label: '8607'},
                    {value: '8608', label: '8608'},
                    {value: '8610', label: '8610'},
                    {value: '8612', label: '8612'},
                    {value: '8616', label: '8616'},
                    {value: '8618', label: '8618'},
                    {value: '8619', label: '8619'},
                    {value: '8620', label: '8620'},
                    {value: '8621', label: '8621'},
                    {value: '8622', label: '8622'},
                    {value: '8623', label: '8623'},
                    {value: '8626', label: '8626'},
                    {value: '8628', label: '8628'},
                    {value: '8630', label: '8630'},
                    {value: '8666', label: '8666'},
                ]
            },
            {
                value: 'sevenFloor',
                label: '7楼',
                children: [
                    {value: '8701', label: '8701'},
                    {value: '8702', label: '8702'},
                    {value: '8703', label: '8703'},
                    {value: '8705', label: '8705'},
                    {value: '8706', label: '8706'},
                    {value: '8707', label: '8707'},
                    {value: '8708', label: '8708'},
                    {value: '8710', label: '8710'},
                    {value: '8712', label: '8712'},
                    {value: '8716', label: '8716'},
                    {value: '8718', label: '8718'},
                    {value: '8719', label: '8719'},
                    {value: '8720', label: '8720'},
                    {value: '8721', label: '8721'},
                    {value: '8722', label: '8722'},
                    {value: '8723', label: '8723'},
                    {value: '8726', label: '8726'},
                    {value: '8728', label: '8728'},
                    {value: '8730', label: '8730'},
                    {value: '7777', label: '7777'},
                ]
            },
            {
                value: 'eightFloor',
                label: '8楼',
                children: [
                    {value: '8801', label: '8801'},
                    {value: '8802', label: '8802'},
                    {value: '8803', label: '8803'},
                    {value: '8805', label: '8805'},
                    {value: '8806', label: '8806'},
                    {value: '8807', label: '8807'},
                    {value: '8808', label: '8808'},
                    {value: '8810', label: '8810'},
                    {value: '8812', label: '8812'},
                    {value: '8816', label: '8816'},
                    {value: '8818', label: '8818'},
                    {value: '8819', label: '8819'},
                    {value: '8820', label: '8820'},
                    {value: '8821', label: '8821'},
                    {value: '8822', label: '8822'},
                    {value: '8823', label: '8823'},
                    {value: '8826', label: '8826'},
                    {value: '8828', label: '8828'},
                    {value: '8830', label: '8830'},
                    {value: '8888', label: '8888'},
                ]
            },
            {
                value: 'nineFloor',
                label: '9楼',
                children: [
                    {value: '8901', label: '8901'},
                    {value: '8902', label: '8902'},
                    {value: '8903', label: '8903'},
                    {value: '8905', label: '8905'},
                    {value: '8906', label: '8906'},
                    {value: '8907', label: '8907'},
                    {value: '8908', label: '8908'},
                    {value: '8910', label: '8910'},
                    {value: '8912', label: '8912'},
                    {value: '8916', label: '8916'},
                    {value: '8918', label: '8918'},
                    {value: '8919', label: '8919'},
                    {value: '8920', label: '8920'},
                    {value: '8921', label: '8921'},
                    {value: '8922', label: '8922'},
                    {value: '8923', label: '8923'},
                    {value: '8926', label: '8926'},
                    {value: '8928', label: '8928'},
                    {value: '8930', label: '8930'},
                    {value: '8999', label: '8999'},
                ]
            },
            {
                value: 'tenFloor',
                label: '10楼',
                children: [
                    {value: '董办', label: '董办'},
                    {value: '1001', label: '1001'},
                    {value: '1002', label: '1002'},
                    {value: '1003', label: '1003'},
                    {value: '1005', label: '1005'},
                    {value: '1006', label: '1006'},
                    {value: '1008', label: '1008'},
                    {value: '1010', label: '1010'},
                    {value: '1012', label: '1012'},
                    {value: '1016', label: '1016'},
                    {value: '1017', label: '1017'},
                    {value: '1018', label: '1018'},
                    {value: '1019', label: '1019'},
                    {value: '1020', label: '1020'},
                    {value: '1021', label: '1021'},
                    {value: '1022', label: '1022'},
                    {value: '1023', label: '1023'},
                    {value: '1026', label: '1026'},
                    {value: '1028', label: '1028'},
                    {value: '1030', label: '1030'},
                ]
            },
        ]
        // 房间缓存
        const ROOM_INFO_KEY = "roomInfoKey:${roomNumber}";
        const SUCCESSFUL_COLOR = '#67C23A'
        const UNSUCCESSFUL_COLOR = '#F56C6C'
    </script>
    <!--缓存相关-->
    <script type="text/javascript">
        const localStorage = window.localStorage;
        function getItem(key) {
            return localStorage.getItem(key);
        }

        function setItem(key, value) {
            return localStorage.setItem(key, value);
        }

        function clear() {
            return localStorage.clear();
        }
    </script>
    <!--工具相关-->
    <script type="text/javascript">
        /**
         * 获取key
         */
        function getKey(template, ...values) {
            let result;
            for (const value of values) {
                result = template = template.replace(/\$\{[a-zA-Z0-9]+\}/, value)
            }
            return result
        }

        /**
         * 格式话日期 yyyy-MM-dd HH:mm:ss
         * @param date
         * @returns {string}
         */
        function formatDateTime(date) {
            date = new Date();
            let fullYear = date.getFullYear();
            let month = date.getMonth();
            let day = date.getDay();
            let hours = date.getHours();
            let minutes = date.getMinutes();
            let seconds = date.getSeconds();
            return '' + fullYear + month + day + hours + minutes + seconds
        }
    </script>
    <!--VUE-->
    <script type="text/javascript">

        Vue.use(Vuex)

        const store = new Vuex.Store({
            // 状态
            state: {
                showFootMenu: true, // 是否显示底部菜单
                // 所有楼层房间信息
                rooms: [],
                // 检查的选项
                checkItems: [
                    {
                        groupId:'门牌号', groupName:'门牌号', items:[
                            {id:'houseNumber', itemName: '门牌号', formType: 'switch', defaultValue: true},
                            {id:'houseNumberErrorMessage', itemName: '门牌号异常信息', formType: 'picker', defaultValue: true, showPrecondition:'houseNumber'},
                            {id:'airSwitch', itemName: '空开', formType: 'switch', defaultValue: true},
                            {id:'peculiarSmell', itemName: '异味', formType: 'switch', defaultValue: true},
                        ]
                    },
                    {
                       groupId:'卫生间', groupName:'卫生间', items:[
                            {id:'toiletDoor', itemName: '厕所门', formType: 'switch', defaultValue: true},
                            {id:'washbasinGlue', itemName: '洗手台胶', formType: 'switch', defaultValue: true},
                            {id:'toiletGlue', itemName: '马桶胶', formType: 'switch', defaultValue: true},
                            {id:'ceiling', itemName: '天花板', formType: 'switch', defaultValue: true},
                            {id:'washbasin', itemName: '脸盆', formType: 'switch', defaultValue: true},
                            {id:'bathroomExhaustFan', itemName: '卫生间排风扇', formType: 'switch', defaultValue: true},
                            {id:'faucet', itemName: '水龙头', formType: 'switch', defaultValue: true},
                        ]
                    },
                    {
                        groupId:'橱柜', groupName:'橱柜', items:[
                            {id:'wardrobe', itemName: '衣柜', formType: 'switch', defaultValue: true},
                            {id:'kettle', itemName: '烧水壶', formType: 'switch', defaultValue: true},
                        ]
                    },
                    {
                        groupId:'睡觉', groupName:'睡觉', items:[
                            {id:'airConditioner', itemName: '空调', formType: 'switch', defaultValue: true},
                            {id:'TV', itemName: '电视', formType: 'switch', defaultValue: true},
                            {id:'TVRemoteControl', itemName: '电视遥控器', formType: 'switch', defaultValue: true},
                            {id:'carpet', itemName: '地毯', formType: 'switch', defaultValue: true},
                            {id:'wallCloth', itemName: '墙布', formType: 'switch', defaultValue: true},
                        ]
                    },
                    {
                        groupId:'休息区', groupName:'休息区', items:[
                            {id:'window', itemName: '窗户', formType: 'switch', defaultValue: true},
                            {id:'sofa', itemName: '沙发', formType: 'switch', defaultValue: true},
                            {id:'swivelChair', itemName: '转椅', formType: 'switch', defaultValue: true},
                        ]
                    },
                    {
                        groupId:'其他', groupName:'其他', items:[
                            {id:'remark', itemName: '备注', formType: 'text', defaultValue: true},
                        ]
                    },
                ],
                // 异常下拉
                roomError:{
                    houseNumberErrorMessage: [
                        { text: '门铃不响'},
                        { text: '请勿打扰和立即清理不亮'}
                    ],
                },
                // 总房间数
                totalRoomNumber: 0,
                // 已检查房间数
                checkedRoomNumber: 0,
                // 未检查房间数
                uncheckedRoomNumber: 0,
                // 有问题房间数
                errorRoomNumber: 0,
            },
            // 包含多个更新state函数的对象
            mutations: {
                /**
                 * 设置显示底部菜单
                 * @param state
                 * @param value
                 */
                setShowFootMenu(state, value) {
                    state.showFootMenu = value
                },
                /**
                 * 实时计算房间数，已检，未检，问题
                 * @param state
                 */
                calculateRoomNumber(state) {
                    let totalRoomNumber = 0;
                    let checkedRoomNumber = 0;
                    let uncheckedRoomNumber = 0;
                    let errorRoomNumber = 0;
                    // 楼层
                    for (const floor of state.rooms) {
                        // 楼层房间
                        for(const room of floor.children) {
                            totalRoomNumber++
                            if(room.checked){
                                checkedRoomNumber++
                            } else {
                                uncheckedRoomNumber++
                            }
                            if(room.isError) {
                                errorRoomNumber++
                            }
                        }
                    }
                    state.totalRoomNumber = totalRoomNumber
                    state.checkedRoomNumber = checkedRoomNumber
                    state.uncheckedRoomNumber = uncheckedRoomNumber
                    state.errorRoomNumber = errorRoomNumber
                },
                /**
                 * 初始化房间
                 * @param state
                 */
                initRooms(state) {
                    state.rooms = []
                    let totalRoomNumber = 0;
                    let checkedRoomNumber = 0;
                    let uncheckedRoomNumber = 0;
                    let errorRoomNumber = 0;
                    // 楼层
                    for (const rawFloor of RAW_FLOORS) {
                        // 添加楼层
                        let floorRooms = []
                        // 楼层房间
                        for(const rawFloorRoom of rawFloor.children) {
                            totalRoomNumber++
                            let rawFloorRoomValue = rawFloorRoom.value
                            // 从缓存取
                            let cacheKey = getKey(ROOM_INFO_KEY, rawFloorRoomValue)
                            let cacheValue = getItem(cacheKey);
                            if (cacheValue !== undefined && cacheValue !== null) {
                                let room = JSON.parse(cacheValue)
                                let isError = room.isError
                                if (isError) {
                                    errorRoomNumber++
                                }
                                floorRooms.push({
                                    value: rawFloorRoom.value,
                                    label: rawFloorRoom.label,
                                    checked: true,
                                    isError: isError,
                                    checkedTime: undefined
                                })
                                checkedRoomNumber++;
                            } else {
                                floorRooms.push({
                                    value: rawFloorRoom.value,
                                    label: rawFloorRoom.label,
                                    checked: false,
                                    isError: false,
                                    checkedTime: undefined
                                })
                                uncheckedRoomNumber++
                            }
                        }
                        let floorItem = {value: rawFloor.value, label: rawFloor.label, children: floorRooms}
                        state.rooms.push(floorItem)
                    }
                    state.totalRoomNumber = totalRoomNumber
                    state.checkedRoomNumber = checkedRoomNumber
                    state.uncheckedRoomNumber = uncheckedRoomNumber
                    state.errorRoomNumber = errorRoomNumber
                },
                /**
                 * 修改房间状态
                 * @param state
                 * @param {object} newRoom
                 * @param {string} object.value 房间唯一标识
                 * @param {boolean} object.checked true 已检查；false 未检查
                 * @param {boolean} object.isError true 问题；false 正常
                 * @param {string} object.checkedTime 检查时间
                 */
                changeRoomStatus(state, newRoom) {
                    state.rooms.forEach(floor => {
                        floor.children.forEach(room => {
                            if (room.value === newRoom.value) {
                                room.checked = newRoom.checked;
                                room.isError = newRoom.isError;
                                room.checkedTime = newRoom.checked ? newRoom.checkedTime : null;
                                return;
                            }
                        })
                    })
                }
            },
            // 包含多个对应事件回调函数
            actions:{

            },
            getters:{
                showFootMenu: () => store.state.showFootMenu,
                rooms:() => store.state.rooms,
                checkItems: () => store.state.checkItems,
                //===
                houseNumberErrorMessage:() => store.state.roomError.houseNumberErrorMessage,
                //==
                totalRoomNumber:() => store.state.totalRoomNumber,
                checkedRoomNumber:() => store.state.checkedRoomNumber,
                uncheckedRoomNumber:() => store.state.uncheckedRoomNumber,
                errorRoomNumber:() => store.state.errorRoomNumber,
            }
        })

        /**
         * 查房组件
         */
        const checkRoomComponent = Vue.component('checkRoom', Vue.extend({
            name: 'checkRoom',
            template: '#checkRoomTemplateId',
            data(){
                return {
                    successfulColor: SUCCESSFUL_COLOR,
                    unsuccessfulColor: UNSUCCESSFUL_COLOR,
                    // 显示下拉
                    showSelectRoomPicker: false,
                    showSelectHouseNumberErrorMessagePicker: false,
                    roomFullName: undefined,
                    title: '检查房间',
                    form: {
                        roomNumber: undefined,      // 房号
                        peculiarSmell: true,   // 异味
                        houseNumber: true,     // 门牌号
                        wardrobe: true,        // 衣柜
                        window: true,          // 窗户
                        wallCloth: true,       // 墙布
                        sofa: true,            // 沙发
                        TVRemoteControl: true, // 电视遥控器
                        TV: true,              // 电视
                        toiletDoor: true,      // 厕所门
                        washbasinGlue: true,  // 洗手台胶
                        toiletGlue: true,      // 马桶胶
                        ceiling: true,         // 天花板
                        washbasin: true,       // 脸盆
                        kettle: true,          // 烧水壶
                        airConditioner: true,  // 空调
                        bathroomExhaustFan: true,    // 卫生间排风扇
                        carpet: true,          // 地毯
                        airSwitch: true,       // 空开
                        swivelChair: true,     // 转椅
                        faucet: true,          // 水龙头
                        remark: undefined,          // 备注
                        isError: undefined,         /// 是否有问题
                        checkedTime: undefined,     /// 检查时间

                        // 需要存储到缓存的额外字段
                        houseNumberSelectErrorMessages: undefined,     /// 门牌号异常信息
                        houseNumberErrorMessages: undefined,     /// 门牌号异常信息
                    },
                }
            },
            methods:{
                /**
                 * 提交
                 * @param value
                 */
                selectRoomPickerOnConfirm(value) {
                    this.roomFullName = value[0] + ' ' + value[1]
                    this.form.roomNumber = value[1]
                    this.showSelectRoomPicker = false;
                },
                selectHouseNumberErrorMessagePickerOnConfirm(value) {
                    this.checkRoom.form.houseNumberErrorMessages
                    this.showSelectHouseNumberErrorMessagePicker = false;
                },
                test() {
                  return store.getters.count
                },
                /**
                 * 检查房间，切换房间
                 * @param selectData    选中的value
                 */
                checkRoomChangeRoom(selectData) {
                    this.checkRoom.form.roomNumber = selectData[1]
                    console.log(selectData)
                },
                /**
                 * 是否显示item
                 */
                showFormItem() {
                    return this.checkRoom.form.roomNumber !== null && this.checkRoom.form.roomNumber !== undefined
                },
                /**
                 * 获取房间的缓存信息，如果缓存不存在就用默认值
                 * @param
                 */
                getRoomInfo(roomNumber) {
                    let key = getKey(ROOM_INFO_KEY, roomNumber)
                    let roomInfo = JSON.parse(getItem(key))
                    console.log(roomNumber + "房间的信息：" + roomInfo);
                    if (roomInfo === null || roomInfo === undefined) {
                        this.initCheckRoomForm(roomNumber);
                        return this.checkRoom.form
                    } else {
                        this.checkRoom.form = { ...roomInfo }
                    }

                    return roomInfo;
                },
                /**
                 * 初始化房间
                 */
                initCheckRoomForm(roomNumber) {
                    this.form.roomNumber = roomNumber;   // 房号
                    this.form.peculiarSmell = true;   // 异味
                    this.form.houseNumber = true;     // 门牌号
                    this.form.houseNumberSelectErrorMessages = null,     // 门牌号异常信息
                        this.form.houseNumberErrorMessages = null,     // 门牌号异常信息
                        this.form.wardrobe = true;        // 衣柜
                    this.form.window = true;          // 窗户
                    this.form.wallCloth = true;       // 墙布
                    this.form.sofa = true;            // 沙发
                    this.form.TVRemoteControl = true; // 电视遥控器
                    this.form.TV = true;              // 电视
                    this.form.toiletDoor = true;      // 厕所门
                    this.form.washbasinGlue = true;  // 洗手台胶
                    this.form.toiletGlue = true;      // 马桶胶
                    this.form.ceiling = true;         // 天花板
                    this.form.washbasin = true;       // 脸盆
                    this.form.kettle = true;          // 烧水壶
                    this.form.airConditioner = true;  // 空调
                    this.form.bathroomExhaustFan = true;    // 卫生间排风扇
                    this.form.carpet = true;          // 地毯
                    this.form.airSwitch = null;    // 空开
                    this.form.swivelChair = true;     // 转椅
                    this.form.faucet = true;          // 水龙头
                    this.form.remark = undefined;  // 备注
                    this.form.isError = undefined;
                    this.form.checkedTime = undefined;
                },
                /**
                 * 选择房牌号的错误信息
                 */
                changeHouseNumberErrorMessage(e) {
                    console.log(e)
                    this.dialog.checkRoom.form.houseNumberErrorMessages = e.join(',')
                    console.log(this.dialog.checkRoom.form.houseNumberErrorMessages);
                },
                /**
                 * 关闭/取消检查房间弹窗
                 */
                exitCheckRoom() {
                    this.$store.commit('setShowFootMenu', true)
                    this.initCheckRoomForm(null)
                    this.$router.push('/')
                },
                /**
                 * 保存
                 * @param {Number} model 模式，0保存并关闭；1：保存并继续
                 */
                saveDialogCheckRoom(model) {
                    this.$refs.checkRoomForm.validate((valid) => {
                        if (valid) {
                            // 当前操作的房间号
                            let roomNumber = this.checkRoom.form.roomNumber

                            let now = formatDateTime(new Date())
                            let newRoom = {value: roomNumber, checked: true, isError: this.isErrorRoom(), checkedTime: now}
                            console.log("roomNumber", newRoom);
                            this.$store.commit('changeRoomStatus', newRoom)
                            // 保存
                            let key = getKey(ROOM_INFO_KEY, roomNumber)
                            let roomInfo = JSON.stringify(this.checkRoom.form);
                            setItem(key, roomInfo)
                            // 重置表单
                            this.initCheckRoomForm(null)
                            this.$message({
                                message: `房间${roomNumber}检查完成`,
                                type: 'success',
                                center: true
                            });
                        }
                    });
                },
                /**
                 * 判断房间是不是有问题
                 * @param room
                 * @returns {boolean}
                 */
                isErrorRoom() {
                    let room = this.checkRoom.form
                    console.log("room", room)
                    if (room) {
                        let isError = !room.peculiarSmell ||
                            !room.houseNumber ||
                            !room.wardrobe ||
                            !room.window ||
                            !room.wallCloth ||
                            !room.sofa ||
                            !room.TVRemoteControl ||
                            !room.TV ||
                            !room.toiletDoor ||
                            !room.washbasinGlue ||
                            !room.toiletGlue ||
                            !room.ceiling ||
                            !room.washbasin ||
                            !room.kettle ||
                            !room.airConditioner ||
                            !room.bathroomExhaustFan ||
                            !room.carpet ||
                            // !room.airSwitch ||
                            !room.swivelChair ||
                            !room.faucet

                        this.checkRoom.form.isError = isError

                        return isError
                    }
                },

            },
            watch: {
                /**
                 * 房间号下拉
                 */
                'checkRoom.form.roomNumber': function (n, o) {
                    console.log("checkRoom.form.roomNumber");
                    if (n !== null && n !== undefined) {
                        console.log(n);
                        this.getRoomInfo(n)
                        this.title = `检查 ${n} 房间`;
                    } else {
                        this.title = '检查房间'
                    }
                },
                /**
                 * 门牌号
                 */
                'checkRoom.form.houseNumber': {
                    handler(n, o) {
                        if (n) {
                            this.checkRoom.form.houseNumberSelectErrorMessages = [];
                            this.checkRoom.form.houseNumberErrorMessages = null;
                        }
                    }
                },
            },
            beforeCreate(){
                this.$store.commit('setShowFootMenu', false)
            },
        }))


        /*组件*/
        var routerObj = new VueRouter({
            //  route // 这个配置对象中的 route 表示 【路由匹配规则】 的意思
            routes:[ // 路由匹配规则
                // 每个路由规则，都是一个对象，这个规则对象身上，有两个必须的属性：
                // 属性1：是path，表示监听哪个路由链接地址
                // 属性2：是 component， 表示，如果 路由是前面匹配到的 path，则展示 component 属性对应的那个组件
                //  注意：component 的属性值，必须是一个 组件模板对象，不能是模板名称
                // {path:'/', component: login},
                {path:'/', redirect: '/checkRoom'}, // 这里的 redirect 和 Node 中的 redirect 完全是两码事
                {path:'/checkRoom', component: checkRoomComponent},

            ]
            ,linkActiveClass:'myactive'
        });

        const vm = new Vue({
            el: '#app',
            // components: { dashboardComponent, checkRoomComponent },
            data: {
                showFootMenu: true,
                active: 0,
                // 单选框
                successfulColor: '#67C23A',
                unsuccessfulColor: '#F56C6C',
            },
            methods: {

            },
            mounted() {
                this.$store.commit('initRooms')
            },
            watch: {

            },
            router:routerObj,
            store
        })

        Vue.use(vant.Lazyload);
        Vue.use(vant.Picker);
        Vue.use(vant.Tabbar);
        Vue.use(vant.TabbarItem);
    </script>

    <script type="text/javascript">

    </script>

</body>

</html>
